/****************************************************************************/

/* Texas Instruments France											        */

/*																	        */

/* NAME			Cintrins.c											        */

/*																	        */

/* REVISION		16 Oct.97											        */

/*																	        */

/* DESCRIPTION  C implementation of the `C62xx intrinsics  	    	    	*/

/*																			*/

/****************************************************************************/



#if!defined(_TMS320C6200)

#include "cintrins.h"



Word32 SAT_Bit;



/****************************************************************************/

/* _abs C function                                                          */

/****************************************************************************/

Word32 abs_c(Word32 src1)

{

	if(src1 == MIN_32)

		return((Word40)MAX_32);

	else

		return((src1<0) ? -src1 : src1);

}



/****************************************************************************/

/* _add2 C function                                                         */

/****************************************************************************/

Word32 add2_c(Word32 src1, Word32 src2)

{

	return(	( ((src1&0x0ffff)+(src2&0x0ffff)) &0x0ffff)

		 | ( ( ((src1&0x0ffff0000) >> 16) + 

		    				((src2&0x0ffff0000) >> 16) ) << 16 )   );

}



/****************************************************************************/

/* _clr  C function                                                         */

/****************************************************************************/

UWord32 clr_c(UWord32 src1, UWord32 csta, UWord32 cstb)

{

UWord32 i;

Word32 maska=0x0;

Word32 maskb=0x0ffffffff;

	

	if(csta<=cstb)

	{

		for(i=0;i<csta;i++)

			maska = (maska<<1)+1;



		for(i=0;i<=cstb;i++)

			maskb = maskb << 1;



		maska = maska | maskb;



		return(maska&src1);

	}

	else

	{

		return(src1);

	}

}





/****************************************************************************/

/* _ext  C function                                                         */

/****************************************************************************/

Word32 ext_c(Word32 src1, UWord32 csta, UWord32 cstb)

{

	return( (src1<<csta) >> cstb);

}



/****************************************************************************/

/* _extu C function                                                         */

/****************************************************************************/

UWord32 extu_c(UWord32 src1, UWord32 csta, UWord32 cstb)

{

	return( (src1<<csta) >> cstb);

}





/****************************************************************************/

/* _lmbd C function                                                         */

/****************************************************************************/

UWord32 lmbd_c(UWord32 src1,UWord32 src2)

{

Word32 i=0;

UWord32 mask = 0x80000000;



	if(src1&0x01)

	{					/* Search for a 1 */

	  	while((src2&mask) == 0)

	  	{

			mask = mask >> 1;

			i++;

			if(i==32) return(32);

		}

	}

	else

	{				/* Search for a 0 */

		while((src2&mask) != 0)

		{

			mask = mask >> 1;

			i++;

			if(i==32) return(32);

		}

	}

	return(i);

}





///****************************************************************************/
//
///* _lnorm C function                                                        */
//
///****************************************************************************/
//
//#define MASK39 (Word40)0x8000000000
//
//
//UWord32 lnorm_c(Word40 src2)
//
//{
//
//Word32 i=0;
//
//
//
//	if((src2 >> 39) == 0)	
//
//	{			   		/* Positive Number */
//
//		while((src2 >> 39) != 1)	
//
//		{
//
//			src2 = src2 << 1;
//
//			i++;
//
//			if(i==40) return(39);
//
//		}
//
//	}
//
//	else
//
//	{				/* Negative Number */
//
//		while((src2 >> 39) != 0)	
//
//		{
//
//			src2 = src2 << 1;
//
//			i++;
//
//			if(i==40) return(39);
//
//		}
//
//	}
//
//	return(i-1);
//
//}
//
//
//
//
//
///****************************************************************************/
//
///* _lsadd C function                                                        */
//
///****************************************************************************/
//
//Word40 lsadd_c(Word32 src1, Word40 src2)
//
//{
//
//Word40 result;
//
//
//
//	result = src1 + src2;
//
//
//
//	if( ( (src1>> 31) ^ ( src2 >> 39)) == 0)
//
//	{
//
//		if(((result^src2) >> 39) != 0)
//
//		{
//
//			if(src2<0)
//
//				result = ((Word40)MIN_32 << 8);
//
//			else 
//
//				result = (((Word40)MAX_32 << 8)) + 0xff;
//
//			SAT_Bit = 1;
//
//		}
//
//	}
//
//	return(result);
//
//}
//
//
//
//
//
///****************************************************************************/
//
///* _lssub C function                                                        */
//
///****************************************************************************/
//
//Word40 lssub_c(Word16 src1, Word40 src2)
//
//{
//
//Word40 result;
//
//
//
//	result = (Word40)src1 - src2;
//
//	if( ( ((Word40)src1>> 31) ^ ( src2 >> 39)) != 0)
//
//	{
//
//		if( ( (result>>39) ^ ((Word40)src1 >> 31)) != 0)
//
//		{
//
//			if(src2<0)
//
//				result = ((Word40)MIN_32 << 8);
//
//			else
//
//				result = (((Word40)MAX_32 << 8)) + 0xff;
//
//		}
//
//	}
//
//	return((Word40)result);
//
//}
//





/****************************************************************************/

/* _mpy  C function                                                         */

/****************************************************************************/

Word32 mpy_c(Word32 src1,Word32 src2)

{

	return((Word16)src1 * (Word16)src2);

}





/****************************************************************************/

/* _mpysu  C function                                                       */

/****************************************************************************/

Word32 mpysu_c(Word32 src1, UWord32 src2)

{

	return((Word16)src1 * (UWord16)src2);

}





/****************************************************************************/

/* _mpyus C function                                                        */

/****************************************************************************/

Word32 mpyus_c(UWord32 src1,Word32 src2)

{

	return((UWord16)src1 * (Word16)src2);

}





/****************************************************************************/

/* _mpyu  C function                                                        */

/****************************************************************************/

Word32 mpyu_c(UWord32 src1, UWord32 src2)

{

	return((UWord16)src1 * (UWord16)src2);

}





/****************************************************************************/

/* _mpyh  C function                                                        */

/****************************************************************************/

Word32 mpyh_c(Word32 src1,Word32 src2)

{

	return((Word16)( (src1&0x0ffff0000) >> 16) *

	       (Word16)( (src2&0x0ffff0000) >> 16));

}





/****************************************************************************/

/* _mpyhus  C function                                                      */

/****************************************************************************/

Word32 mpyhus_c(UWord32 src1,Word32 src2)

{

	return((UWord16)( (src1&0x0ffff0000) >> 16) *

	       (Word16)( (src2&0x0ffff0000) >> 16));

}





/****************************************************************************/

/* _mpyhsu  C function                                                      */

/****************************************************************************/

Word32 mpyhsu_c(Word32 src1,UWord32 src2)

{

	return((Word16)( (src1&0x0ffff0000) >> 16) *

	       (UWord16)( (src2&0x0ffff0000) >> 16));

}





/****************************************************************************/

/* _mpyhu  C function                                                       */

/****************************************************************************/

Word32 mpyhu_c(UWord32 src1,UWord32 src2)

{

	return((UWord16)( (src1&0x0ffff0000) >> 16) *

	       (UWord16)( (src2&0x0ffff0000) >> 16));

}





/****************************************************************************/

/* _mpyhl C function                                                        */

/****************************************************************************/

Word32 mpyhl_c(Word32 src1,Word32 src2)

{

	return(	(Word16)((src1&0x0ffff0000) >> 16) * (Word16)src2 );

}





/****************************************************************************/

/* _mpyhuls C function                                                      */

/****************************************************************************/

Word32 mpyhuls_c(UWord32 src1,Word32 src2)

{

	return(	(UWord16)((src1&0x0ffff0000) >> 16) * (Word16)src2 );

}





/****************************************************************************/

/* _mpyhslu C function                                                      */

/****************************************************************************/

Word32 mpyhslu_c(Word32 src1,UWord32 src2)

{

	return(	(Word16)((src1&0x0ffff0000) >> 16) * (UWord16)src2 );

}





/****************************************************************************/

/* _mpyhlu C function                                                       */

/****************************************************************************/

Word32 mpyhlu_c(UWord32 src1,UWord32 src2)

{

	return(	(UWord16)((src1&0x0ffff0000) >> 16) *

											 (UWord16)src2 );

}





/****************************************************************************/

/* _mpylh C function                                                        */

/****************************************************************************/

Word32 mpylh_c(Word32 src1,Word32 src2)

{

	return((Word16)src1 * (Word16)((src2&0x0ffff0000) >> 16)  );

}





/****************************************************************************/

/* _mpyluhs C function                                                      */

/****************************************************************************/

Word32 mpyluhs_c(UWord32 src1,Word32 src2)

{

	return((UWord16)src1 * (Word16)((src2&0x0ffff0000) >> 16)  );

}





/****************************************************************************/

/* _mpylshu C function                                                      */

/****************************************************************************/

Word32 mpylshu_c(Word32 src1,UWord32 src2)

{

	return((Word16)src1 * (UWord16)((src2&0x0ffff0000) >> 16)  );

}





/****************************************************************************/

/* _mpylhu C function                                                       */

/****************************************************************************/

Word32 mpylhu_c(UWord32 src1,UWord32 src2)

{

	return((UWord16)src1 * (UWord16)((src2&0x0ffff0000) >> 16));

}





/****************************************************************************/

/* _norm C function                                                         */

/****************************************************************************/

#define MASK31 (Word32)0x80000000



UWord32 norm_c(Word32 src2)

{

Word32 i=0;



	if( !(src2 & MASK31))	

	{			   		/* Positive Number */

		while((src2 & MASK31) != MASK31)	

		{

			src2 = src2 << 1;

			i++;

			if(i==32) return(31);

		}

	}

	else

	{				/* Negative Number */

		while((src2 & MASK31) != 0)	

		{

			src2 = src2 << 1;

			i++;

			if(i==32) return(31);

		}



	}

	return(i-1);

}





/****************************************************************************/

/* _sadd C function                                                         */

/****************************************************************************/

Word32 sadd_c(Word32 src1, Word32 src2)

{

Word32 result;

	result = src1 + src2;



	if( ((src1 ^ src2) & MIN_32) == 0)

	{

		if((result ^ src1) & MIN_32)

		{

			result = (src1<0) ? MIN_32 : MAX_32;

			SAT_Bit = 1;

		}

	}

	return(result);

}





/****************************************************************************/

/* _sat  C function                                                         */

/****************************************************************************/

Word32 sat_c(Word40 src2)

{

	if(src2 > MAX_32) {

		SAT_Bit = 1;

		return(MAX_32);

	}

	else {

		if(src2 < MIN_32) {

			SAT_Bit = 1;

			return(MIN_32);

      }

		else {

			return(src2);

		}

   }

}





/****************************************************************************/

/* _set  C function                                                         */

/****************************************************************************/

UWord32 set_c(UWord32 src1,UWord32 csta,UWord32 cstb)

{

UWord32 i;

Word32 maska=0x0ffffffff;

Word32 maskb=0x01;

	

	if(csta<=cstb)

	{

		for(i=0;i<csta;i++)

			maska = maska << 1;



		for(i=0;i<cstb;i++)

			maskb = (maskb << 1) + 1;



		maska = maska & maskb;



		return(maska | src1);

	}

	else

	{

		return(src1);

	}

}





/****************************************************************************/

/* _smpy C function                                                         */

/****************************************************************************/

Word32 smpy_c(Word32 src1,Word32 src2)

{

Word32 result;



	result = ((Word16)src1 * (Word16)src2) << 1;



	if (result != MIN_32)

		return(result);

	else {

		SAT_Bit = 1;

		return(MAX_32);

	}

}





/****************************************************************************/

/* _smpyh C function                                                        */

/****************************************************************************/

Word32 smpyh_c(Word32 src1,Word32 src2)

{

Word32 result;



	result = ( (Word16)((src1&0x0ffff0000) >> 16) * 

	          (Word16)((src2&0x0ffff0000) >> 16)) << 1;



	if ( result != MIN_32)

		return(result);

	else {

		SAT_Bit = 1;

		return(MAX_32);

	}

}



/****************************************************************************/

/* _smpyhl C function                                                       */

/****************************************************************************/

Word32 smpyhl_c(Word32 src1,Word32 src2)

{

Word32 result;



	result = ( (Word16)((src1&0x0ffff0000) >> 16) * (Word16)src2) << 1;



	if (result != MIN_32)

		return(result);

	else {

		SAT_Bit = 1;

		return(MAX_32);

	}

}





/****************************************************************************/

/* _smpylh C function                                                       */

/****************************************************************************/

Word32 smpylh_c(Word32 src1,Word32 src2)

{

Word32 result;

	

	result = ((Word16)src1 * (Word16)((src2&0x0ffff0000) >> 16)) << 1;



	if ( result != MIN_32)

		return(result);

	else {

		SAT_Bit = 1;

		return(MAX_32);

	}

}





/****************************************************************************/

/* _sshl C function                                                         */

/****************************************************************************/

Word32 sshl_c(Word32 src2, UWord32 src1)

{

UWord32 i;



	src1=src1&0x01f; 		/* Consider only the five least significant bits */



	if( norm_c(src2) >= src1)

	{			

		for(i=0; i<src1 ;i++)

	 		src2 = src2 << 1;

		return(src2);

	}

	else

	{

		SAT_Bit = 1;

		return((src2>0) ? MAX_32 : MIN_32);

	}

}





/****************************************************************************/

/* _ssub C function                                                         */

/****************************************************************************/

Word32 ssub_c(Word32 src1, Word32 src2)

{

Word32 result;

	result = src1 - src2;



	if( ((src1 ^ src2) & MIN_32) != 0)

	{

		if((result ^ src1) & MIN_32)

		{

			result = (src1<0) ? MIN_32 : MAX_32;

			SAT_Bit = 1;	

		}

	}

	return(result);

}





/****************************************************************************/

/* _sub2 C function                                                         */

/****************************************************************************/

Word32 sub2_c(Word32 src1, Word32 src2)

{


	return( (((src1 & 0x0ffff) - (src2 & 0x0ffff)) & 0x0ffff) |

		( ( ((src1 & 0xffff0000) >> 16) - ((src2 & 0xffff0000) >> 16) ) << 16) );

}





/****************************************************************************/

/* _subc C function                                                         */

/****************************************************************************/

UWord32 subc_c(UWord32 src1, UWord32 src2)

{

	if( src1 >= src2)

		return( ((src1-src2) << 1) + 1);

	else	

		return(src1<<1);

}



#endif







